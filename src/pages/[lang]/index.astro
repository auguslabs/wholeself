---
/**
 * Página Home por idioma - WholeSelf Counseling
 *
 * Ruta dinámica: /es/ y /en/
 */

import BaseLayout from '@/layouts/BaseLayout.astro';
import CTASection from '@/components/home/CTASection.astro';
import ValuePropositions from '@/components/home/ValuePropositions';
import HomeContentFromApi from '@/components/home/HomeContentFromApi';
import { getPageContent, getLocalizedText } from '@/data/services/contentService';
import { supportedLocales, type SupportedLocale } from '@/utils/i18n';

// Habilitar pre-renderizado estático para esta página
export const prerender = true;

export function getStaticPaths() {
  return ['es'].map((lang) => ({
    params: { lang },
  }));
}

const paramLang = Astro.params.lang as SupportedLocale | undefined;

if (!paramLang || !supportedLocales.includes(paramLang)) {
  return Astro.redirect('/');
}

if (paramLang === 'en') {
  return Astro.redirect('/');
}

const lang = paramLang;

// Cargar contenido desde JSON por idioma
const homeData = await getPageContent('home', lang);
const hero = homeData.content.hero;
const valuePropositions = homeData.content.valuePropositions;

// Usar título SEO del JSON
const pageTitle = getLocalizedText(homeData.seo.title, lang);
const pageDescription = getLocalizedText(homeData.seo.description, lang);
// Usar la descripción más completa del hero para los metadatos
const metaDescription = getLocalizedText(homeData.content.hero.description, lang);
const baseUrl = (import.meta.env.BASE_URL || '/').replace(/\/$/, '');
const heroBg = getLocalizedText(homeData.content.hero.backgroundImage, lang);
const ogImage = heroBg;
const heroImageSrc = heroBg ? (baseUrl ? `${baseUrl}/${heroBg.replace(/^\//, '')}` : heroBg) : '';
const useContentFromApi = import.meta.env.PUBLIC_USE_CONTENT_FROM_BD === 'true' || import.meta.env.PUBLIC_USE_CONTENT_FROM_BD === true;
---

<BaseLayout title={pageTitle} description={metaDescription} ogImage={ogImage}>
  {useContentFromApi ? (
    <HomeContentFromApi client:load lang={lang} initialData={homeData} />
  ) : (
    <>
      <section id="home-hero" class="relative flex items-center justify-center min-h-[60vh] py-12 overflow-hidden">
        <img
          src={heroImageSrc}
          alt={getLocalizedText(hero.backgroundImageAlt, lang)}
          class="absolute inset-0 w-full h-full object-cover object-center"
        />
        <div class="relative z-10 flex flex-col items-center justify-center w-full max-w-4xl mx-auto px-4">
          <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold text-white mb-6 text-center">
            {getLocalizedText(hero.headline, lang)}
          </h1>
          <p class="text-lg md:text-xl text-white mb-8 text-center max-w-3xl">
            {getLocalizedText(hero.description, lang)}
          </p>
        </div>
      </section>
      {valuePropositions && (
        <ValuePropositions client:load items={valuePropositions.items} language={lang} />
      )}
      <CTASection ctaSection={homeData.content.ctaSection} lang={lang} />
    </>
  )}
</BaseLayout>

