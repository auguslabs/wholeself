---
/**
 * Página Rates - WholeSelf Counseling
 * 
 * Página de información sobre precios, seguros y opciones de pago.
 * Contenido cargado desde rates.json
 */

// Importar el layout base
import BaseLayout from '@/layouts/BaseLayout.astro';
import { getPageContent, getLocalizedText } from '@/data/services/contentService';
import { getLocaleFromPathname } from '@/utils/i18n';
import PricingTable from '@/components/rates/PricingTable';
import RatesCard from '@/components/rates/RatesCard';
import InsuranceCardWithModal from '@/components/rates/InsuranceCardWithModal';
import RatesFAQ from '@/components/rates/RatesFAQ';
import RatesCTASection from '@/components/rates/RatesCTASection';

// Detectar idioma desde la URL
const lang = getLocaleFromPathname(Astro.url.pathname);

// Cargar contenido desde JSON por idioma
const ratesData = await getPageContent('rates', lang);
const hero = ratesData.content.hero;
const pricing = ratesData.content.pricing;
const insurance = ratesData.content.insurance;
const paymentOptions = ratesData.content.paymentOptions;
const faq = ratesData.content.faq;
const ctaSection = ratesData.content.ctaSection;

// Usar título SEO del JSON
const pageTitle = getLocalizedText(ratesData.seo.title, lang);
---

<!-- Usar el layout base con título personalizado -->
<BaseLayout title={pageTitle}>
  <!-- Hero Section -->
  <section id="rates-hero" class="relative flex items-center justify-center min-h-[40vh] py-12 bg-cover bg-center bg-no-repeat" style={`background-image: url('${(import.meta.env.BASE_URL || '/').replace(/\/$/, '')}/banner-rates.webp');`}>
    <!-- Overlay verde con transparencia del 90% -->
    <div class="absolute inset-0 bg-blueGreen-500/90"></div>
    <!-- Contenido sobre la imagen -->
    <div class="relative z-10 text-center max-w-4xl mx-auto px-4">
      <h1 class="text-[1.584rem] md:text-[2.116rem] font-bold text-white mb-4">
        {getLocalizedText(hero.title, lang)}
      </h1>
      {hero.subtitle && (
        <p class="text-xl text-white leading-relaxed">
          {getLocalizedText(hero.subtitle, lang)}
        </p>
      )}
    </div>
  </section>

  <!-- Pricing Table -->
  <PricingTable 
    client:load
    sessions={pricing.sessions}
    language={lang}
    title={pricing.title}
  />

  <!-- Cards Section: Insurance and Payment Options -->
  <section id="rates-cards" class="py-12 px-4 bg-gray-50">
    <div class="container mx-auto max-w-6xl">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 lg:gap-8">
        <!-- Insurance Card with Modal -->
        <InsuranceCardWithModal
          client:load
          title={insurance.title}
          description={insurance.description}
          icon="ShieldCheckIcon"
          language={lang}
          items={insurance.providers}
          providerList={insurance.providerList}
          modal={insurance.modal}
          colorClass="border-blueGreen-500"
        />

        <!-- Payment Options Card -->
        <RatesCard
          client:load
          title={paymentOptions.title}
          description={paymentOptions.description}
          icon="CreditCardIcon"
          language={lang}
          items={paymentOptions.options}
          colorClass="border-navy-500"
        />
      </div>
    </div>
  </section>

  <!-- FAQ Section -->
  <RatesFAQ
    client:load
    questions={faq.questions}
    language={lang}
    title={faq.title}
  />

  <!-- CTA Section -->
  <RatesCTASection
    client:load
    title={ctaSection.title}
    subtitle={ctaSection.subtitle}
    primaryCTA={ctaSection.primaryCTA}
    secondaryCTA={ctaSection.secondaryCTA}
    language={lang}
    insuranceModal={{
      providerList: insurance.providerList,
      title: insurance.modal.title,
      description: insurance.modal.description,
      outOfNetworkInfo: insurance.modal.outOfNetworkInfo,
      note: insurance.modal.note,
    }}
  />
</BaseLayout>
